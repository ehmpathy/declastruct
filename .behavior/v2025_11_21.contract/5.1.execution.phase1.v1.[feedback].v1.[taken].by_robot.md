# Feedback Response: Phase 1 Blockers

## Blocker 1: Collocate tests per file ✅

### What was requested
Move tests from `src/__test__/verification/phase1.test.ts` into files scoped per domain object file.

### What was done
Created collocated test files for each domain object:

1. **`src/domain.objects/IsoTimestamp.test.ts`**
   - Tests that IsoTimestamp is a string type

2. **`src/domain.objects/DeclastructChange.test.ts`**
   - Tests DeclastructChangeAction enum (5 action types)
   - Tests DeclastructChange domain literal
   - Tests default type parameter behavior

3. **`src/domain.objects/DeclastructDao.test.ts`**
   - Tests DAO interface structure
   - Tests optional method support

4. **`src/domain.objects/DeclastructProvider.test.ts`**
   - Tests provider with all required properties
   - Tests default type parameters

5. **`src/domain.objects/DeclastructPlan.test.ts`**
   - Tests plan with all required properties
   - Tests unique key configuration
   - Tests DomainEntity extension

### Verification
- Removed `src/__test__/` directory entirely
- All 11 tests passing ✅
- Tests now collocated with their respective domain object files

---

## Blocker 2: Import HasMetadata from type-fns ✅

### What was requested
Remove custom `HasMetadata` type definition and import it from the proper package.

### Investigation
Checked mechanic briefs and found examples showing:
```typescript
import { HasMetadata, PickOne } from 'type-fns';
```

Confirmed `HasMetadata` exists in `type-fns` at:
```
node_modules/type-fns/dist/checks/hasMetadata.d.ts
```

### What was done
Updated `src/domain.objects/DeclastructDao.ts`:

**Before:**
```typescript
import {
  DomainEntity,
  DomainLiteral,
  Ref,
  Refable,
  RefByPrimary,
  RefByUnique,
} from 'domain-objects';

/**
 * .what = resource instance with persistence metadata
 * .why = represents a resource that has been persisted and has metadata properties
 */
export type HasMetadata<T> = T & {
  id?: number;
  uuid?: string;
  createdAt?: Date;
  updatedAt?: Date;
  effectiveAt?: Date;
};
```

**After:**
```typescript
import {
  DomainEntity,
  DomainLiteral,
  Ref,
  Refable,
  RefByPrimary,
  RefByUnique,
} from 'domain-objects';
import { HasMetadata } from 'type-fns';
```

### Understanding HasMetadata from type-fns

From the type definition, `HasMetadata<T>`:
- Makes optional metadata keys required
- Default metadata keys: `id`, `uuid`, `createdAt`, `updatedAt`, `deletedAt`, `effectiveAt`
- Does not add new properties, only makes existing optional ones required
- Does not affect non-metadata optional keys

This is the correct type to use for DAO return values, as it ensures persisted resources have their metadata properties populated.

### Verification
- TypeScript compilation: ✅ PASS
- All 11 unit tests: ✅ PASS

---

---

## Additional Improvement

### Use DemoResource and constructor.name

Updated test files to:
- Rename `TestResource` → `DemoResource` (clearer naming for demo/test fixtures)
- Use `DemoResource.constructor.name` instead of hardcoded string `'TestResource'` for consistency

This ensures the test class names match the actual constructor names programmatically.

---

## Summary

Both blockers have been resolved:

✅ **Blocker 1**: Tests are now collocated per file (5 test files created, old test directory removed)
✅ **Blocker 2**: `HasMetadata` now imported from `type-fns` instead of custom definition
✅ **Additional**: Test resources renamed to `DemoResource` and using `constructor.name`

All tests passing with proper mechanic patterns followed: **11/11 PASS** ✅
